<div class="dashboard-container">
  <!-- Modern Glass Navbar -->
  <div class="navbar">
    <div class="navbar-content">
      <div class="navbar-brand">
        <div class="logo-container">
          <img src="assets/emdep-logo.png" alt="Logo EMDEP" class="navbar-logo">
        </div>
        <div class="navbar-titles">
          <h1 class="navbar-title">{{ 'dashboard.title' | translate }}</h1>
          <p class="navbar-subtitle">{{ 'dashboard.subtitle' | translate }}</p>
        </div>
      </div>
      
      <div class="navbar-actions">
        <button mat-icon-button class="notification-btn" (click)="toggleAlertPanel()" [matTooltip]="'dashboard.notifications' | translate">
          <div class="notification-icon-container">
            <mat-icon>notifications</mat-icon>
            <span class="notification-badge" *ngIf="alertCount > 0">{{alertCount}}</span>
          </div>
        </button>
      </div>
    </div>
    
    <div class="alert-panel" *ngIf="showAlertPanel" @slideIn>
      <div class="alert-panel-header">
        <h3>{{ 'dashboard.alerts_and_notifications' | translate }}</h3>
        <button mat-icon-button (click)="toggleAlertPanel()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <div *ngIf="alerts.length === 0" class="no-alerts">
        <div class="no-alerts-content">
          <mat-icon>check_circle</mat-icon>
          <p>{{ 'dashboard.no_active_alerts' | translate }}</p>
        </div>
      </div>
      <div class="alert-items-container">
        <div *ngFor="let alert of alerts" class="alert-item" [class.stuck]="alert.type === 'stuck'" 
             [class.full]="alert.type === 'full'" [class.utilization]="alert.type === 'utilization'">
          <div class="alert-item-header">
            <mat-icon *ngIf="alert.type === 'stuck'">warning</mat-icon>
            <mat-icon *ngIf="alert.type === 'full'">error</mat-icon>
            <mat-icon *ngIf="alert.type === 'utilization'">trending_up</mat-icon>
            <span class="alert-item-title">{{alert.title}}</span>
          </div>
          <div class="alert-item-time">{{alert.time | date:'short'}}</div>
          <div class="alert-item-content">{{alert.content}}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modern Tab Navigation -->
  <nav class="modern-tabs">
    <div class="tabs-container">
      <button *ngFor="let tab of tabs" class="tab-button" 
              [class.active]="activeTab === tab" (click)="setActiveTab(tab)">
        <div class="tab-content">
          <mat-icon class="tab-icon">
            {{tab === 'map' ? 'map' : tab === 'bagets' ? 'view_list' : 'insights'}}
          </mat-icon>
          <span class="tab-label">
            {{tab === 'map' ? ('dashboard.map' | translate) : tab === 'bagets' ? ('dashboard.bagets' | translate) : ('dashboard.analytics' | translate)}}
          </span>
        </div>
      </button>
    </div>
  </nav>

  <!-- Loading and Error States -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-content">
      <mat-spinner diameter="48" strokeWidth="4"></mat-spinner>
      <p>{{ 'dashboard.loading' | translate }}</p>
    </div>
  </div>

  <div *ngIf="errorMessage" class="error-state">
    <div class="error-content">
      <mat-icon color="warn">error_outline</mat-icon>
      <p>{{errorMessage}}</p>
      <button mat-stroked-button color="warn" (click)="loadData()">{{ 'dashboard.retry' | translate }}</button>
    </div>
  </div>

  <!-- Map View -->
  <div class="tab-content" *ngIf="activeTab === 'map' && !loading && !errorMessage" @fadeIn>
    <div class="map-controls">
      <button mat-stroked-button (click)="toggleMapSize()" class="map-control-button">
        <mat-icon>{{mapExpanded ? 'fullscreen_exit' : 'fullscreen'}}</mat-icon>
        {{mapExpanded ? ('dashboard.reduce' | translate) : ('dashboard.enlarge' | translate)}} la carte
      </button>
    </div>

    <div class="warehouse-map">
      <div class="map-container" [@expandMap]="mapExpanded ? 'expanded' : 'collapsed'">
        <!-- Stations -->
        <div class="station station-1">
          <div class="station-icon-container">
            <div class="station-icon">1</div>
          </div>
          <div class="station-metrics">
            <div class="metric">
              <span class="value">{{getStationCount('STATION_1')}}</span>
              <span class="label">{{ 'dashboard.items' | translate }}</span>
            </div>
            <div class="metric">
              <span class="value">{{getBagetCount('STATION_1')}}</span>
              <span class="label">{{ 'dashboard.bagets' | translate }}</span>
            </div>
          </div>
        </div>

        <div class="station station-2">
          <div class="station-icon-container">
            <div class="station-icon">2</div>
          </div>
          <div class="station-metrics">
            <div class="metric">
              <span class="value">{{getStationCount('STATION_2')}}</span>
              <span class="label">{{ 'dashboard.items' | translate }}</span>
            </div>
            <div class="metric">
              <span class="value">{{getBagetCount('STATION_2')}}</span>
              <span class="label">{{ 'dashboard.bagets' | translate }}</span>
            </div>
          </div>
        </div>

        <div class="station station-3">
          <div class="station-icon-container">
            <div class="station-icon">3</div>
          </div>
          <div class="station-metrics">
            <div class="metric">
              <span class="value">{{getStationCount('DELIVERED')}}</span>
              <span class="label">{{ 'dashboard.items' | translate }}</span>
            </div>
            <div class="metric">
              <span class="value">{{getBagetCount('DELIVERED')}}</span>
              <span class="label">{{ 'dashboard.bagets' | translate }}</span>
            </div>
          </div>
        </div>

        <!-- Bagets -->
        <div *ngFor="let baget of bagets" 
             class="baget"
             [style.left.%]="getBagetPosition(baget).x"
             [style.top.%]="getBagetPosition(baget).y"
             [style.background-color]="bagetColors[baget.emplacement] || generateColor(baget.emplacement)"
             [class.moving]="baget.moving"
             [class]="getBagetClass(baget)"
             (mouseenter)="showBagetDetails(baget, $event)"
             (mouseleave)="hideBagetDetails()"
             (click)="selectBaget(baget.emplacement)">
          <div class="baget-pulse"></div>
          <div class="baget-label">{{baget.emplacement}}</div>
        </div>
      </div>
    </div>
  </div>
</div>
